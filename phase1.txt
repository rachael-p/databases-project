1. Rachael Pei, Alina Pan
2. Target domain: environmental data from the EPA toxics release inventory (TRI) about production and use of toxic chemicals.
3. English questions our system should be able to answer
For a given reporting year, which facilities in a specified state reported to TRI, and what were their total releases across all media (air, water, land)?
For each EPA region and year, what is the total amount of toxic releases by medium (air, water, land) for all chemicals combined?
For each chemical in a given year, what is the total quantity released across all facilities and media, and which 10 chemicals have the largest total releases?
For carcinogenic chemicals only, what is the total amount released per state in a given year, and which states have the highest carcinogen releases?
For PFAS chemicals, what is the average annual total release per EPA region over a specified range of years?
For a selected facility, how have its total releases (broken down by medium) changed over time across multiple years?
Which facilities both produce and import the same chemical in the same year, and what are the total releases for that chemical at those facilities?
For each industry (based on NAICS or similar industry_code), what is the total toxic release in a given year, and which industries contribute the most to overall releases?
For each chemical, how many distinct facilities and how many distinct states reported that chemical in a given year?
For a given state and year, which chemicals have the largest total releases, and are any of them flagged as carcinogens, PFAS, or metals?
For each POTW facility, what is the total amount of toxic chemicals transferred to it in a given year, and which 5 POTWs receive the largest total transfers?
For each facility and year, what is the total quantity of chemicals transferred to POTWs versus the total quantity directly released to the environment (sum of air, water, and land releases)?
Which facilities have implemented source reduction activities in a given year, what types of activities (src_red_code and description) did they adopt, and what estimated annual reduction codes did they report?
Which facilities have large total environmental releases (above a given threshold) in a year but reported no source reduction activities for that year?
For a specific source reduction activity code, how many implementations were reported over a range of years, and in which industries and states were these activities most commonly adopted?
4. Relational data model: 
   Facility(facility_id PK, facility_name, city, state, region_code FK->EPARegion, email)
   EPARegion(region_code PK, region_desc)
   Chemical(cas_reg_num PK, chem_name, carcinogen, pfas, metal)
   Form(doc_ctrl_num PK, facility_id FK->Facility, cas_reg_num FK->Chemical, year, max_amt_code FK->MaxAmtChem, produces, imports, sale_dist, byproduct, process_impurity, industry_code FK->Industry)
   MaxAmtChem(max_amt_code PK, max_amt_desc)
   Industry(industry_code PK, industry_desc)
   ReleaseRecord(doc_ctrl_num FK->Form, medium, total_release, PK(doc_ctrl_num, medium))
   SourceReductionActivity(src_red_code PK, src_red_desc)
   ImplementsSourceReduction(doc_ctrl_num FK->FORM, src_red_code FK->SourceReductionActivity, activity_num, est_annual_red_code FK->EstimatedAnnualReduction, PK(doc_ctrl_num, activity_num))
   EstimatedAnnualReduction(est_annual_red_code PK, est_annual_desc)
   POTWFacility(potw_id PK, potw_name, potw_city, potw_state)
   TransferredToPOTW(doc_ctrl_num FK->Form, potw_id FK->POTWFacility, potw_num, transfer_amt, PK(doc_ctrl_num, potw_num))
5. Representative SQL statements for sample queries

-- Q1: For a given year and state, list all facilities and their total releases across all media.
SELECT
    f.facility_id,
    f.facility_name,
    f.city,
    f.state,
    SUM(r.total_release) AS total_release_all_media
FROM Form AS frm
JOIN Facility AS f
    ON frm.facility_id = f.facility_id
JOIN ReleaseRecord AS r
    ON frm.doc_ctrl_num = r.doc_ctrl_num
WHERE frm.year = 2022          
  AND f.state = 'MD'           
GROUP BY
    f.facility_id,
    f.facility_name,
    f.city,
    f.state
ORDER BY total_release_all_media DESC;

-- Q2: For each EPA region and medium, total toxic releases in a given year.
SELECT
    e.region_code,
    e.region_desc,
    r.medium,
    SUM(r.total_release) AS total_release
FROM Form AS frm
JOIN Facility AS f
    ON frm.facility_id = f.facility_id
JOIN EPARegion AS e
    ON f.region_code = e.region_code
JOIN ReleaseRecord AS r
    ON frm.doc_ctrl_num = r.doc_ctrl_num
WHERE frm.year = 2022
GROUP BY
    e.region_code,
    e.region_desc,
    r.medium
ORDER BY
    e.region_code,
    r.medium;

-- Q3: Top 10 chemicals by total releases in a given year (all media, all facilities).
SELECT
    c.cas_reg_num,
    c.chem_name,
    SUM(r.total_release) AS total_release_all_media
FROM Form AS frm
JOIN Chemical AS c
    ON frm.cas_reg_num = c.cas_reg_num
JOIN ReleaseRecord AS r
    ON frm.doc_ctrl_num = r.doc_ctrl_num
WHERE frm.year = 2022
GROUP BY
    c.cas_reg_num,
    c.chem_name
ORDER BY total_release_all_media DESC
LIMIT 10;

-- Q4: Total carcinogen releases per state for a given year.
SELECT
    f.state,
    SUM(r.total_release) AS total_carcinogen_release
FROM Form AS frm
JOIN Facility AS f
    ON frm.facility_id = f.facility_id
JOIN Chemical AS c
    ON frm.cas_reg_num = c.cas_reg_num
JOIN ReleaseRecord AS r
    ON frm.doc_ctrl_num = r.doc_ctrl_num
WHERE frm.year = 2022
  AND c.carcinogen = TRUE
GROUP BY f.state
ORDER BY total_carcinogen_release DESC;

-- Q5: Facilities that both produce and import the same chemical in the same year.
SELECT
    frm.facility_id,
    f.facility_name,
    frm.cas_reg_num,
    c.chem_name,
    frm.year,
    SUM(r.total_release) AS total_release_all_media
FROM Form AS frm
JOIN Facility AS f
    ON frm.facility_id = f.facility_id
JOIN Chemical AS c
    ON frm.cas_reg_num = c.cas_reg_num
JOIN ReleaseRecord AS r
    ON frm.doc_ctrl_num = r.doc_ctrl_num
WHERE frm.produces = TRUE
  AND frm.imports = TRUE
  AND frm.year = 2022
GROUP BY
    frm.facility_id,
    f.facility_name,
    frm.cas_reg_num,
    c.chem_name,
    frm.year
ORDER BY total_release_all_media DESC;

-- Q6: For each industry, total toxic release in a given year.
SELECT
    i.industry_code,
    i.industry_desc,
    SUM(r.total_release) AS total_release_all_media
FROM Form AS frm
JOIN Industry AS i
    ON frm.industry_code = i.industry_code
JOIN ReleaseRecord AS r
    ON frm.doc_ctrl_num = r.doc_ctrl_num
WHERE frm.year = 2022
GROUP BY
    i.industry_code,
    i.industry_desc
ORDER BY total_release_all_media DESC;

-- Q7: For each chemical, distinct facilities and states that reported it in a given year.
SELECT
    c.cas_reg_num,
    c.chem_name,
    COUNT(DISTINCT frm.facility_id) AS num_facilities,
    COUNT(DISTINCT f.state) AS num_states
FROM Form AS frm
JOIN Chemical AS c
    ON frm.cas_reg_num = c.cas_reg_num
JOIN Facility AS f
    ON frm.facility_id = f.facility_id
WHERE frm.year = 2022
GROUP BY
    c.cas_reg_num,
    c.chem_name
ORDER BY num_facilities DESC;

-- Q8: Total amount transferred to each POTW in a given year, top 10 POTWs.
SELECT
    p.potw_id,
    p.potw_name,
    p.potw_city,
    p.potw_state,
    SUM(t.transfer_amt) AS total_transfer_amt
FROM TransferredToPOTW AS t
JOIN POTWFacility AS p
    ON t.potw_id = p.potw_id
JOIN Form AS frm
    ON t.doc_ctrl_num = frm.doc_ctrl_num
WHERE frm.year = 2022
GROUP BY
    p.potw_id,
    p.potw_name,
    p.potw_city,
    p.potw_state
ORDER BY total_transfer_amt DESC
LIMIT 10;

-- Q9: Facilities with large releases but no source reduction activities in a given year.
WITH FacilityRelease AS (
    SELECT
        frm.doc_ctrl_num,
        frm.facility_id,
        SUM(r.total_release) AS total_release_all_media
    FROM Form AS frm
    JOIN ReleaseRecord AS r
        ON frm.doc_ctrl_num = r.doc_ctrl_num
    WHERE frm.year = 2022
    GROUP BY
        frm.doc_ctrl_num,
        frm.facility_id
),
DocsWithSourceReduction AS (
    SELECT DISTINCT doc_ctrl_num
    FROM ImplementsSourceReduction
)
SELECT
    fr.facility_id,
    f.facility_name,
    f.city,
    f.state,
    SUM(fr.total_release_all_media) AS total_release_all_media
FROM FacilityRelease AS fr
JOIN Facility AS f
    ON fr.facility_id = f.facility_id
LEFT JOIN DocsWithSourceReduction AS d
    ON fr.doc_ctrl_num = d.doc_ctrl_num
WHERE d.doc_ctrl_num IS NULL
GROUP BY
    fr.facility_id,
    f.facility_name,
    f.city,
    f.state
HAVING SUM(fr.total_release_all_media) > 10000   -- threshold can be adjusted
ORDER BY total_release_all_media DESC;

-- Q10: For a given source reduction activity code, count implementations by state.
SELECT
    s.src_red_code,
    s.src_red_desc,
    f.state,
    COUNT(*) AS num_implementations
FROM ImplementsSourceReduction AS isr
JOIN SourceReductionActivity AS s
    ON isr.src_red_code = s.src_red_code
JOIN Form AS frm
    ON isr.doc_ctrl_num = frm.doc_ctrl_num
JOIN Facility AS f
    ON frm.facility_id = f.facility_id
WHERE s.src_red_code = 'S23'     -- example source reduction code (newer Sxx code)
  AND frm.year BETWEEN 2018 AND 2022
GROUP BY
    s.src_red_code,
    s.src_red_desc,
    f.state
ORDER BY num_implementations DESC;


6. Sources: https://www.epa.gov/enviro/tri-ez-search, mostly from the flat form R tables and the 'Chemical Transfers to POTW Locations' table; https://ordspub.epa.gov/ords/guideme_ext/guideme_ext/guideme/file/tri%20reporting%20codes%20for%20form%20r%20and%20form%20a%20-%20july%202022.pdf for code descriptions
Anticipated conversion issues: we will need to create some columns ourselves and change some formatting. For instance, the total releases are listed as AirTotalRelease, LandTotalRelease, etc. but we want to create a generalized ReleaseRecord that will have an attribute for the type of medium instead, which will require some preprocessing on our part. We will also need to create numberings/relative orderings ourselves to number entites like the source reduction activities and POTWs: they are labeled as POTW 1, POTW 2, etc. in the raw data, but we will need to extract those numbers and make them an attribute instead to create generalized entitities.
7. We plan to start by querying the database directly through the MySQL command-line client / Workbench and exporting results as tabular reports (CSV or HTML tables). We will define a few SQL views to provide convenient summaries, such as a view that aggregates total releases by facility, year, and medium, and another that aggregates transfers to POTWs by year.
For Phase II, we plan to add a simple web-based dashboard (e.g., using a lightweight Python/Flask or similar framework) that lets users filter by year, state, chemical, or industry via HTML forms, and then displays results both as tables and as basic charts (e.g., bar charts of total releases by state or medium). This interface will serve as the front end for our more advanced features such as a natural language query interface.
8. It would be interesting to look at natural language interfaces (ex. having the user be able to type in a query in English and our system will be able to process that and create analyses/outputs).

